---
title: 'Вопросы потребления трафика и ресурса батареи'
visible: true
---

Иногда вы можете заметить, что, согласно встроенной статистике Android, Adguard расходует большое количество трафика и/или ресурса батареи.

Обе эти проблемы являются разными сторонами одной медали. Так как в процессе фильтрации весь мобильный трафик проходит через Adguard, Android считает, что именно Adguard потребляет его весь. В реальности это, конечно, не так.

Расход батареи и трафика, показываемый в статистике устройства, не соответствует действительности. Дело в том, что Android приписывает Adguard весь мобильный и Wi-Fi трафик, который был на самом деле потреблен другими приложениями. Из-за этого доля Adguard значительно повышается, а доля остальных приложений, наоборот, снижается.

#### Реальный пример

На скриншотах ниже показана статистика потребления батареи за ночь и утро.

![](battery_1.png) ![](battery_2.png) ![](battery_3.png)

Из этих скриншотов видно, что:

1. Adguard предсказуемо находится наверху сводной таблицы. Это вообще характерно для телефонов (и совсем не характерно для планшетов без 3G, потому что Wi-Fi с точки зрения расхода батареи потребляет намного меньше).

2. Обратите внимание на количество отправленных пакетов Mobile и Wi-Fi, которые засчитались Adguard'у (Mobile packets sent и Wi-Fi packets sent) на скриншоте №2.

3. На скриншоте №3 статистика одного из реальных потребителей трафика, Яндекс Браузер. На его счет вообще трафика почти не засчиталось, хотя на деле 70% трафика израсходовано именно им.

#### Сколько заряда батареи на самом деле потребляет Adguard?

Для начала приведём немного теории и ссылок с необходимыми данными.

1. Android считает потребление трафика исходя из так называемого Power Profile, который предоставляется каждым производителем: [https://source.android.com/devices/tech/power/values.html](https://source.android.com/devices/tech/power/values.html)

2. Главная часть Power Profile - это набор значений, выраженных в миллиамперах, которые определяют потребление батареи каждым компонентом устройства: [https://source.android.com/devices/tech/power/values.html](https://source.android.com/devices/tech/power/values.html)

Например, из таблички по ссылке выше:

wifi.active=31mA дополнительное потребление в миллиамперах, вызванное передачей данных по Wi-Fi.

radio.active=100-300mA дополнительное потребление в миллиамперах, вызванное передачей данных по мобильной сети.

cpu.active=100-200mA дополнительное потребление в миллиамперах, вызванное работой CPU

3. Adguard самостоятельно почти не потребляет трафика, так что для оценки потребления батареи отбросим значения Mobile/Wi-Fi packets и остановимся на подсчете CPU.

Формула для вычисления потребления:

>"CPU TIME (ms)" X "cpu.active" / (60 * 60 * 1000) = "POWER USE mAh"

Подставим в эту формулу реальные значения.

Возьмем CPU total из второго скриншота и переведём в миллисекунды: 506000.

Коэффициент cpu.active для 2GHz будет равен примерно 225mA.

Финальный результат:

>506000 * 225 / (60 * 60 * 1000) = 31,625mAh

#### Итог

Реальное потребление в разы ниже показанного в статистике Android. Вместо 220mAh оно должно быть в районе 31-40mAh. С другой стороны, потребление браузера должно быть не 66mAh, а около 200mAh.